<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Status</title>
    <link rel="stylesheet" href="/css/status.css" />
    <link rel="stylesheet" href="/css/navbar.css" />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <script src="/JS/status"></script>
  </head>
  <body>
    <nav>
      <ul>
        <li>
          <a href="/user/dashboard" class="logo">
            <img src="/images/platform.jpg" alt="" />
            <span class="nav-item">Platform</span>
          </a>
        </li>
        <li>
          <a href="/user/profile">
            <i class="bx bxs-user"></i>
            <span class="nav-item">Profile</span>
          </a>
        </li>
        <li>
          <a href="/user/status">
            <i class="bx bx-stats"></i>
            <span class="nav-item">Stats</span>
          </a>
        </li>
        <li>
          <a href="/" class="logout">
            <i class="bx bx-log-out"></i>
            <span id="logout" class="nav-item">Log Out</span>
          </a>
        </li>
      </ul>
    </nav>

    <% let totalGames = 0; %> <% let gamesWon = 0; %> <% for (var i = 0; i <
    game.length; i++) { %> <% if (game[i].winner === user.userName ||
    game[i].otherPlayer === user.userName) { %> <% totalGames++; %> <% if
    (game[i].winner === user.userName) { %> <% gamesWon++; %> <% } %> <% } %> <%
    } %> <% let winRate = parseInt((gamesWon / totalGames) * 100); %>

    <div class="container">
      <div class="section">
        <p>Wins : <span><%- gamesWon %></span></p>
        <p>Total games played : <span><%- totalGames %></span></p>
        <p>Win Rate : <span><%- winRate %>%</span></p>
      </div>
      <div class="section">
        <img
          class="profile"
          src="/images/profiles/<%- user.profilePhoto %>"
          alt="Profile"
        />
        <p>UserName: <span><%- user.userName %></span></p>
      </div>

      <% game.sort((a, b) => b.timeWhenPlayed - a.timeWhenPlayed ); %> <% const
      recentDates = {}; %> <%game.forEach(game => { %> <%if
      (!recentDates[game.gameName]) { %> <% recentDates[game.gameName] =
      game.timeWhenPlayed; %> <%} %> <%}); %> <% console.log(recentDates);%>

      <div class="section">
        <h4>Last played on</h4>
        <% Object.entries(recentDates).forEach(([gameName, date]) => { %> <%
        const day = String(date.getDate()).padStart(2, "0"); %> <% const month =
        String(date.getMonth() + 1).padStart(2, "0"); %> <% const year =
        String(date.getFullYear()); %>
        <p>
          <%= gameName %> : <span><%= day + "/" + month + "/" + year %></span>
        </p>
        <% }); %>
      </div>

      <div class="section">
        <H4>Friends</H4>
        <% friends.forEach(friend => { %>
        <p><%= friend %></p>
        <% }); %>
      </div>
    </div>
  </body>
</html>
